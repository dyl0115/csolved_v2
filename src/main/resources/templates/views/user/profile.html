<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/lucide@latest"></script>
        <title>내 프로필 수정</title>
    </head>
    
    <body class="bg-gray-50">
        <!-- 네비게이션 -->
        <div th:replace="~{/fragments/navigation :: navigation(${user})}"></div>
        
        <!-- 페이지 배너 -->
        <div class="w-full bg-gradient-to-r from-gray-800 to-gray-900 text-white py-12 px-4">
            <div class="container mx-auto">
                <div class="flex items-center space-x-3">
                    <i data-lucide="user-circle" class="w-8 h-8"></i>
                    <h1 class="text-3xl font-bold">내 프로필 수정</h1>
                </div>
                <p class="mt-2 text-gray-300">프로필 정보와 비밀번호를 관리하세요</p>
            </div>
        </div>
        
        <!-- 메인 컨텐츠 -->
        <div class="container mx-auto px-4 py-8">
            <div class="max-w-2xl mx-auto space-y-6">
                
                <!-- 프로필 정보 카드 -->
                <div class="profile-container bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="border-b border-gray-200 px-6 py-4 bg-gray-50">
                        <h2 class="text-lg font-semibold text-gray-800 flex items-center space-x-2">
                            <i data-lucide="user" class="w-5 h-5"></i>
                            <span>프로필 정보</span>
                        </h2>
                    </div>
                    
                    <div class="p-6">
                        <!-- 프로필 이미지 -->
                        <div class="flex justify-center mb-8">
                            <div class="relative w-36 h-36">
                                <img th:src="@{${userProfile.profileImage} ?: '/images/default-profile.png'}"
                                     alt="프로필 이미지"
                                     class="w-36 h-36 rounded-full object-cover border-4 border-gray-200 shadow-md"
                                     id="profile-image-preview">
                                <label class="absolute bottom-0 right-0 w-11 h-11 bg-gray-800 rounded-full flex items-center justify-center cursor-pointer border-3 border-white shadow-lg hover:bg-gray-700 hover:scale-105 transition-all duration-300"
                                       title="프로필 이미지 변경">
                                    <input type="hidden"
                                           id="profile-image-url"
                                           name="profileImage"
                                           th:value="${userProfile.profileImage}">
                                    <input type="file"
                                           class="hidden"
                                           accept="image/*"
                                           id="profile-image-input"
                                           name="profileImage">
                                    <i data-lucide="camera" class="w-5 h-5 text-white"></i>
                                </label>
                            </div>
                        </div>
                        
                        <!-- 회원 아이디 -->
                        <input type="hidden"
                               id="user-id"
                               th:value="${userProfile.userId}"/>
                        
                        <!-- 이메일 (읽기 전용) -->
                        <div class="mb-5">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                이메일
                            </label>
                            <div class="flex items-center">
                                <div class="flex-1 px-4 py-3 bg-gray-100 border border-gray-200 rounded-lg text-gray-600">
                                    <span th:text="${userProfile.email}">user@example.com</span>
                                </div>
                                <span class="ml-3 text-xs text-gray-500 flex items-center">
                                    <i data-lucide="lock" class="w-3 h-3 mr-1"></i>
                                    변경 불가
                                </span>
                            </div>
                        </div>
                        
                        <!-- 닉네임 입력 -->
                        <div class="mb-6">
                            <label for="nickname" class="block text-sm font-semibold text-gray-700 mb-2">
                                닉네임
                            </label>
                            <input type="text"
                                   id="nickname"
                                   name="nickname"
                                   th:value="${userProfile.nickname}"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-transparent transition"
                                   placeholder="닉네임을 입력하세요">
                            <p id="nickname-error" class="mt-2 text-sm text-red-600 items-center space-x-1 hidden">
                                <i data-lucide="alert-circle" class="w-4 h-4 inline"></i>
                                <span id="nickname-error-message"></span>
                            </p>
                        </div>
                        
                        <!-- 프로필 업데이트 확인 메시지 -->
                        <div id="profile-success-message"
                             class="mb-6 bg-green-50 border border-green-200 rounded-lg p-4 flex items-start space-x-3 hidden">
                            <i data-lucide="check-circle" class="w-5 h-5 text-green-600 mt-0.5"></i>
                            <p class="text-green-800 font-medium">프로필이 성공적으로 업데이트되었습니다!</p>
                        </div>
                        
                        <!-- 프로필 에러 메시지 -->
                        <div id="profile-error-message"
                             class="mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start space-x-3 hidden">
                            <i data-lucide="alert-circle" class="w-5 h-5 text-red-600 mt-0.5"></i>
                            <p class="text-red-800 font-medium" id="profile-error-text"></p>
                        </div>
                        
                        <!-- 버튼 -->
                        <div class="flex space-x-3">
                            <button type="button"
                                    id="profile-update-btn"
                                    class="flex-1 flex items-center justify-center space-x-2 px-6 py-3 bg-gray-800 text-white font-semibold rounded-lg hover:bg-gray-700 focus:ring-4 focus:ring-gray-300 transition">
                                <i data-lucide="save" class="w-5 h-5"></i>
                                <span>프로필 저장</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 비밀번호 변경 카드 -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="border-b border-gray-200 px-6 py-4 bg-gray-50">
                        <h2 class="text-lg font-semibold text-gray-800 flex items-center space-x-2">
                            <i data-lucide="key" class="w-5 h-5"></i>
                            <span>비밀번호 변경</span>
                        </h2>
                    </div>
                    
                    <div class="p-6">
                        <div id="password-update-container">
                            
                            <!-- 현재 비밀번호 -->
                            <div class="mb-5">
                                <label for="current-password"
                                       class="block text-sm font-semibold text-gray-700 mb-2">
                                    현재 비밀번호
                                </label>
                                <div class="relative password-input-container">
                                    <input type="password"
                                           id="current-password"
                                           name="current-password"
                                           class="password-input w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-transparent transition"
                                           placeholder="현재 비밀번호를 입력하세요">
                                    <button type="button"
                                            id="current-password-toggle-btn"
                                            class="password-toggle-btn absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                                        <i data-lucide="eye" class="password-icon w-5 h-5" id="currentPasswordIcon"></i>
                                    </button>
                                </div>
                                <p id="current-password-error" class="mt-2 text-sm text-red-600 hidden">
                                    <i data-lucide="alert-circle" class="w-4 h-4 inline"></i>
                                    <span id="current-password-error-message"></span>
                                </p>
                            </div>
                            
                            <!-- 새 비밀번호 -->
                            <div class="mb-5">
                                <label for="new-password-input" class="block text-sm font-semibold text-gray-700 mb-2">
                                    새 비밀번호
                                </label>
                                <div class="relative password-input-container">
                                    <input type="password"
                                           id="new-password-input"
                                           name="new-password"
                                           class="password-input w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-transparent transition"
                                           placeholder="새 비밀번호를 입력하세요">
                                    <button type="button"
                                            id="new-password-toggle-btn"
                                            onclick="togglePassword('newPassword')"
                                            class="password-toggle-btn absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                                        <i data-lucide="eye" class="password-icon w-5 h-5" id="newPasswordIcon"></i>
                                    </button>
                                </div>
                                <!-- 비밀번호 강도 표시 -->
                                <div id="password-strength" class="mt-3 hidden">
                                    <div class="flex items-center space-x-2 mb-2">
                                        <div class="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                                            <div id="strength-bar" class="h-full transition-all duration-300"
                                                 style="width: 0%"></div>
                                        </div>
                                        <span id="strength-text" class="text-xs font-medium w-16"></span>
                                    </div>
                                    <ul class="text-xs text-gray-600 space-y-1">
                                        <li id="length-check" class="flex items-center space-x-1">
                                            <i data-lucide="circle" class="check-icon w-3 h-3"></i>
                                            <span>8자 이상</span>
                                        </li>
                                        <li id="uppercase-check" class="flex items-center space-x-1">
                                            <i data-lucide="circle" class="check-icon w-3 h-3"></i>
                                            <span>대문자 포함</span>
                                        </li>
                                        <li id="lowercase-check" class="flex items-center space-x-1">
                                            <i data-lucide="circle" class="check-icon w-3 h-3"></i>
                                            <span>소문자 포함</span>
                                        </li>
                                        <li id="number-check" class="flex items-center space-x-1">
                                            <i data-lucide="circle" class="check-icon w-3 h-3"></i>
                                            <span>숫자 포함</span>
                                        </li>
                                        <li id="special-check" class="flex items-center space-x-1">
                                            <i data-lucide="circle" class="check-icon w-3 h-3"></i>
                                            <span>특수문자 포함</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- 새 비밀번호 확인 -->
                            <div class="mb-6 password-">
                                <label for="new-password-confirm-input"
                                       class="block text-sm font-semibold text-gray-700 mb-2">
                                    새 비밀번호 확인
                                </label>
                                <div class="relative password-input-container">
                                    <input type="password"
                                           id="new-password-confirm-input"
                                           name="confirmPassword"
                                           class="password-input w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-transparent transition"
                                           placeholder="새 비밀번호를 다시 입력하세요">
                                    <button type="button"
                                            id="new-password-confirm-toggle-btn"
                                            onclick="togglePassword('new-password-confirm')"
                                            class="password-toggle-btn absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                                        <i data-lucide="eye" class="password-icon w-5 h-5" id="confirmPasswordIcon"></i>
                                    </button>
                                </div>
                                <p id="password-match-error" class="mt-2 text-sm text-red-600 hidden">
                                    <i data-lucide="alert-circle" class="w-4 h-4 inline"></i>
                                    <span>비밀번호가 일치하지 않습니다</span>
                                </p>
                                <p id="password-match-success" class="mt-2 text-sm text-green-600 hidden">
                                    <i data-lucide="check-circle" class="w-4 h-4 inline"></i>
                                    <span>비밀번호가 일치합니다</span>
                                </p>
                            </div>
                            
                            <!-- 비밀번호 변경 성공 메시지 -->
                            <div id="password-success-message"
                                 class="mb-6 bg-green-50 border border-green-200 rounded-lg p-4 flex items-start space-x-3 hidden">
                                <i data-lucide="check-circle" class="w-5 h-5 text-green-600 mt-0.5"></i>
                                <p class="text-green-800 font-medium">비밀번호가 성공적으로 변경되었습니다!</p>
                            </div>
                            
                            <!-- 비밀번호 변경 에러 메시지 -->
                            <div id="password-error-message"
                                 class="mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start space-x-3 hidden">
                                <i data-lucide="alert-circle" class="w-5 h-5 text-red-600 mt-0.5"></i>
                                <p class="text-red-800 font-medium" id="password-error-text"></p>
                            </div>
                            
                            <!-- 버튼 -->
                            <button type="submit"
                                    id="password-submit-btn"
                                    class="w-full flex items-center justify-center space-x-2 px-6 py-3 bg-gray-800 text-white font-semibold rounded-lg hover:bg-gray-700 focus:ring-4 focus:ring-gray-300 transition">
                                <i data-lucide="shield-check" class="w-5 h-5"></i>
                                <span>비밀번호 변경</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 계정 삭제 카드 -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden border border-red-100">
                    <div class="border-b border-red-100 px-6 py-4 bg-red-50">
                        <h2 class="text-lg font-semibold text-red-800 flex items-center space-x-2">
                            <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                            <span>계정 삭제</span>
                        </h2>
                    </div>
                    
                    <div class="p-6">
                        <p class="text-gray-600 mb-4">
                            계정을 삭제하면 모든 데이터가 영구적으로 삭제되며 복구할 수 없습니다.
                        </p>
                        <button type="button"
                                id="withdraw-btn"
                                class="flex items-center space-x-2 px-4 py-2 border-2 border-red-500 text-red-500 font-semibold rounded-lg hover:bg-red-500 hover:text-white transition">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                            <span>계정 삭제하기</span>
                        </button>
                    </div>
                </div>
                
                <!-- 돌아가기 버튼 -->
                <div class="text-center">
                    <a th:href="@{/user/activity}"
                       class="inline-flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i>
                        <span>내 활동으로 돌아가기</span>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- 계정 삭제 확인 모달 -->
        <div id="delete-modal"
             class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
                <div class="p-6">
                    <div class="flex items-center justify-center w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full">
                        <i data-lucide="alert-triangle" class="w-8 h-8 text-red-600"></i>
                    </div>
                    <h3 class="text-xl font-bold text-center text-gray-900 mb-2">정말 계정을 삭제하시겠습니까?</h3>
                    <p class="text-gray-600 text-center mb-6">
                        이 작업은 되돌릴 수 없습니다. 모든 데이터가 영구적으로 삭제됩니다.
                    </p>
                    
                    <div id="delete-account-container">
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                확인을 위해 비밀번호를 입력하세요
                            </label>
                            <input type="password"
                                   name="password"
                                   id="delete-confirm-password"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
                                   placeholder="비밀번호">
                        </div>
                        <div id="withdraw-error-message"
                             class="mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start space-x-3 hidden">
                            <i data-lucide="alert-circle" class="w-5 h-5 text-red-600 mt-0.5"></i>
                            <p class="text-red-800 font-medium" id="withdraw-error-text"></p>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button type="button"
                                    id="withdraw-cancel-btn"
                                    class="flex-1 px-4 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition">
                                취소
                            </button>
                            <button type="submit"
                                    id="withdraw-confirm-btn"
                                    class="flex-1 px-4 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition">
                                삭제하기
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div th:replace="~{/fragments/footer :: default-footer}"></div>
        
        <script type="module">
            import * as userProfileUI from '/js/user/ui/userProfileUI.js';

            document.addEventListener('DOMContentLoaded', function ()
            {
                userProfileUI.init();
                lucide.createIcons();
            });
        
        </script>
    </body>
</html>