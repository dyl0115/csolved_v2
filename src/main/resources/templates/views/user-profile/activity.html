<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
        <title>내 활동</title>
        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Lucide Icons -->
        <script src="https://unpkg.com/lucide@latest"></script>
    </head>
    
    <body class="bg-gray-50">
        <!-- 네비게이션 -->
        <div th:replace="~{/layout/navigation :: navigation(${user})}"></div>
        
        <!-- 페이지 배너 -->
        <div class="w-full bg-gradient-to-r from-gray-800 to-gray-900 text-white py-12 px-4">
            <div class="container mx-auto">
                <div class="flex items-center space-x-3">
                    <i data-lucide="activity" class="w-8 h-8"></i>
                    <h1 class="text-3xl font-bold">내 활동</h1>
                </div>
                <p class="mt-2 text-gray-300">북마크와 작성한 글, 댓글을 확인하세요</p>
            </div>
        </div>
        
        <!-- 메인 컨텐츠 -->
        <div class="container mx-auto px-4 py-8">
            <!-- 탭 네비게이션 -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
                <ul class="flex border-b border-gray-200" id="activityTab" role="tablist">
                    <li class="flex-1" role="presentation">
                        <button class="w-full flex items-center justify-center space-x-2 px-4 py-4 text-gray-800 font-semibold border-b-2 border-gray-800 bg-gray-50 transition hover:bg-gray-100"
                                id="bookmarks-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#bookmarkList"
                                type="button"
                                role="tab"
                                aria-controls="bookmarks"
                                aria-selected="true"
                                onclick="switchTab('bookmarks')">
                            <i data-lucide="bookmark" class="w-5 h-5"></i>
                            <span>북마크</span>
                        </button>
                    </li>
                    <li class="flex-1" role="presentation">
                        <button class="w-full flex items-center justify-center space-x-2 px-4 py-4 text-gray-500 font-semibold border-b-2 border-transparent transition hover:bg-gray-50 hover:text-gray-800"
                                id="posts-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#userPostList"
                                type="button"
                                role="tab"
                                aria-controls="posts"
                                aria-selected="false"
                                onclick="switchTab('posts')">
                            <i data-lucide="file-text" class="w-5 h-5"></i>
                            <span>작성한 글</span>
                        </button>
                    </li>
                    <li class="flex-1" role="presentation">
                        <button class="w-full flex items-center justify-center space-x-2 px-4 py-4 text-gray-500 font-semibold border-b-2 border-transparent transition hover:bg-gray-50 hover:text-gray-800"
                                id="comments-tab"
                                data-bs-toggle="tab"
                                data-bs-target="#repliedPostList"
                                type="button"
                                role="tab"
                                aria-controls="comments"
                                aria-selected="false"
                                onclick="switchTab('comments')">
                            <i data-lucide="message-circle" class="w-5 h-5"></i>
                            <span>댓글 단 글</span>
                        </button>
                    </li>
                </ul>
            </div>
            
            <!-- 탭 컨텐츠 -->
            <div id="activityTabContent">
                <!-- 북마크 탭 -->
                <div class="block"
                     id="bookmarkList"
                     role="tabpanel"
                     aria-labelledby="bookmarks-tab"
                     th:fragment="bookmarkList"
                     th:with="bookmarks=${bookmarks},
                              bookmarkPagination=${bookmarkPagination}">
                    
                    <div th:if="${#lists.isEmpty(bookmarks)}"
                         class="bg-white rounded-lg shadow-md p-16 text-center">
                        <i data-lucide="bookmark" class="w-16 h-16 mx-auto text-gray-400 mb-4"></i>
                        <p class="text-xl font-semibold text-gray-700 mb-2">북마크한 게시글이 없습니다</p>
                        <p class="text-gray-500">관심있는 게시글을 북마크해보세요!</p>
                    </div>
                    
                    <div class="space-y-3" th:if="${!#lists.isEmpty(bookmarks)}">
                        <a class="block bg-white rounded-lg shadow-sm hover:shadow-md transition p-4 border border-gray-200 hover:border-gray-300"
                           th:each="bookmark: ${bookmarks}"
                           th:href="@{'/post/' + ${bookmark.id}}">
                            
                            <!-- 게시글 제목 -->
                            <h3 class="text-lg font-bold text-gray-800 mb-2 line-clamp-1"
                                th:text="${bookmark.title}">게시글 제목</h3>
                            
                            <!-- 태그 -->
                            <div class="flex flex-wrap gap-2 mb-3">
                                <span class="inline-flex items-center px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded"
                                      th:each="tag:${bookmark.tags}"
                                      th:text="${tag.name}">태그명</span>
                            </div>
                            
                            <!-- 메타 정보 -->
                            <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-gray-500">
                                <!-- 게시판 이름 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="layout-grid" class="w-4 h-4"></i>
                                    커뮤니티
                                </div>
                                
                                <!-- 카테고리 이름 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="folder" class="w-4 h-4"></i>
                                    <span th:text="${bookmark.categoryName}">자유</span>
                                </div>
                                
                                <!-- 댓글 수 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="message-circle" class="w-4 h-4"></i>
                                    <span th:text="${bookmark.answerCount}">0</span>
                                </div>
                                
                                <!-- 좋아요 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="heart" class="w-4 h-4"></i>
                                    <span th:text="${bookmark.likes}">0</span>
                                </div>
                                
                                <!-- 조회수 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                    <span th:text="${bookmark.views}">0</span>
                                </div>
                                
                                <!-- 작성자 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="user" class="w-4 h-4"></i>
                                    <span th:text="${bookmark.anonymous ? '익명' : bookmark.authorNickname}">글쓴이</span>
                                </div>
                                
                                <!-- 작성시간 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="clock" class="w-4 h-4"></i>
                                    <span class="timeago" th:data-date="${bookmark.createdAt}">1시간 전</span>
                                </div>
                            </div>
                        </a>
                    </div>
                    
                    <!-- 페이지네이션 -->
                    <div class="mt-8 flex items-center justify-center space-x-4">
                        <!-- 이전 페이지 -->
                        <button th:if="${bookmarkPagination.currentPage > 1}"
                                th:onclick="|updateBookmarkList(${bookmarkPagination.currentPage - 1})|"
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition">
                            <i data-lucide="chevron-left" class="w-4 h-4"></i>
                            <span>이전</span>
                        </button>
                        <button th:unless="${bookmarkPagination.currentPage > 1}"
                                disabled
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed">
                            <i data-lucide="chevron-left" class="w-4 h-4"></i>
                            <span>이전</span>
                        </button>
                        
                        <!-- 페이지 입력 -->
                        <div class="flex items-center space-x-2">
                            <input type="number"
                                   th:value="${bookmarkPagination.currentPage}"
                                   th:min="1"
                                   th:max="${bookmarkPagination.totalPage}"
                                   onchange="updateBookmarkList(this.value)"
                                   class="w-16 px-3 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-gray-800">
                            <span class="text-gray-500" th:text="'/ ' + ${bookmarkPagination.totalPage}">/ 10</span>
                        </div>
                        
                        <!-- 다음 페이지 -->
                        <button th:if="${bookmarkPagination.currentPage < bookmarkPagination.totalPage}"
                                th:onclick="|updateBookmarkList(${bookmarkPagination.currentPage + 1})|"
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition">
                            <span>다음</span>
                            <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                        <button th:unless="${bookmarkPagination.currentPage < bookmarkPagination.totalPage}"
                                disabled
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed">
                            <span>다음</span>
                            <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 작성한 글 탭 -->
                <div class="hidden"
                     id="userPostList"
                     role="tabpanel"
                     aria-labelledby="posts-tab"
                     th:fragment="userPostList"
                     th:with="myPosts=${myPosts},
                              myPostPagination=${myPostPagination}">
                    
                    <div th:if="${#lists.isEmpty(myPosts)}"
                         class="bg-white rounded-lg shadow-md p-16 text-center">
                        <i data-lucide="file-text" class="w-16 h-16 mx-auto text-gray-400 mb-4"></i>
                        <p class="text-xl font-semibold text-gray-700 mb-2">작성한 게시글이 없습니다</p>
                        <p class="text-gray-500">첫 번째 글을 작성해보세요!</p>
                    </div>
                    
                    <div class="space-y-3" th:if="${!#lists.isEmpty(myPosts)}">
                        <a class="block bg-white rounded-lg shadow-sm hover:shadow-md transition p-4 border border-gray-200 hover:border-gray-300"
                           th:each="post: ${myPosts}"
                           th:href="@{'/post/' + ${post.id}}">
                            
                            <!-- 게시글 제목 -->
                            <h3 class="text-lg font-bold text-gray-800 mb-2 line-clamp-1"
                                th:text="${post.title}">게시글 제목</h3>
                            
                            <!-- 태그 -->
                            <div class="flex flex-wrap gap-2 mb-3">
                                <span class="inline-flex items-center px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded"
                                      th:each="tag:${post.tags}"
                                      th:text="${tag.name}">태그명</span>
                            </div>
                            
                            <!-- 메타 정보 -->
                            <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-gray-500">
                                <!-- 게시판 이름 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="layout-grid" class="w-4 h-4"></i>
                                    커뮤니티
                                </div>
                                
                                <!-- 카테고리 이름 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="folder" class="w-4 h-4"></i>
                                    <span th:text="${post.categoryName}">자유</span>
                                </div>
                                
                                <!-- 댓글 수 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="message-circle" class="w-4 h-4"></i>
                                    <span th:text="${post.answerCount}">0</span>
                                </div>
                                
                                <!-- 좋아요 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="heart" class="w-4 h-4"></i>
                                    <span th:text="${post.likes}">0</span>
                                </div>
                                
                                <!-- 조회수 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                    <span th:text="${post.views}">0</span>
                                </div>
                                
                                <!-- 작성자 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="user" class="w-4 h-4"></i>
                                    <span th:text="${post.anonymous ? '익명' : post.authorNickname}">글쓴이</span>
                                </div>
                                
                                <!-- 작성시간 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="clock" class="w-4 h-4"></i>
                                    <span class="timeago" th:data-date="${post.createdAt}">1시간 전</span>
                                </div>
                            </div>
                        </a>
                    </div>
                    
                    <!-- 페이지네이션 -->
                    <div class="mt-8 flex items-center justify-center space-x-4">
                        <!-- 이전 페이지 -->
                        <button th:if="${myPostPagination.currentPage > 1}"
                                th:onclick="|updateUserPostList(${myPostPagination.currentPage - 1})|"
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition">
                            <i data-lucide="chevron-left" class="w-4 h-4"></i>
                            <span>이전</span>
                        </button>
                        <button th:unless="${myPostPagination.currentPage > 1}"
                                disabled
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed">
                            <i data-lucide="chevron-left" class="w-4 h-4"></i>
                            <span>이전</span>
                        </button>
                        
                        <!-- 페이지 입력 -->
                        <div class="flex items-center space-x-2">
                            <input type="number"
                                   th:value="${myPostPagination.currentPage}"
                                   th:min="1"
                                   th:max="${myPostPagination.totalPage}"
                                   onchange="updateUserPostList(this.value)"
                                   class="w-16 px-3 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-gray-800">
                            <span class="text-gray-500" th:text="'/ ' + ${myPostPagination.totalPage}">/ 10</span>
                        </div>
                        
                        <!-- 다음 페이지 -->
                        <button th:if="${myPostPagination.currentPage < myPostPagination.totalPage}"
                                th:onclick="|updateUserPostList(${myPostPagination.currentPage + 1})|"
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition">
                            <span>다음</span>
                            <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                        <button th:unless="${myPostPagination.currentPage < myPostPagination.totalPage}"
                                disabled
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed">
                            <span>다음</span>
                            <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 댓글 단 글 탭 -->
                <div class="hidden"
                     id="repliedPostList"
                     role="tabpanel"
                     aria-labelledby="comments-tab"
                     th:fragment="repliedPostList"
                     th:with="repliedPosts=${replied},
                              repliedPagination=${repliedPagination}">
                    
                    <div th:if="${#lists.isEmpty(repliedPosts)}"
                         class="bg-white rounded-lg shadow-md p-16 text-center">
                        <i data-lucide="message-circle" class="w-16 h-16 mx-auto text-gray-400 mb-4"></i>
                        <p class="text-xl font-semibold text-gray-700 mb-2">작성한 댓글이 없습니다</p>
                        <p class="text-gray-500">게시글에 댓글을 남겨보세요!</p>
                    </div>
                    
                    <div class="space-y-3" th:if="${!#lists.isEmpty(repliedPosts)}">
                        <a class="block bg-white rounded-lg shadow-sm hover:shadow-md transition p-4 border border-gray-200 hover:border-gray-300"
                           th:each="post: ${repliedPosts}"
                           th:href="@{'/post/' + ${post.id}}">
                            
                            <!-- 게시글 제목 -->
                            <h3 class="text-lg font-bold text-gray-800 mb-2 line-clamp-1"
                                th:text="${post.title}">게시글 제목</h3>
                            
                            <!-- 태그 -->
                            <div class="flex flex-wrap gap-2 mb-3">
                                <span class="inline-flex items-center px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded"
                                      th:each="tag:${post.tags}"
                                      th:text="${tag.name}">태그명</span>
                            </div>
                            
                            <!-- 메타 정보 -->
                            <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-gray-500">
                                <!-- 게시판 이름 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="layout-grid" class="w-4 h-4"></i>
                                    커뮤니티
                                </div>
                                
                                <!-- 카테고리 이름 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="folder" class="w-4 h-4"></i>
                                    <span th:text="${post.categoryName}">자유</span>
                                </div>
                                
                                <!-- 댓글 수 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="message-circle" class="w-4 h-4"></i>
                                    <span th:text="${post.answerCount}">0</span>
                                </div>
                                
                                <!-- 좋아요 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="heart" class="w-4 h-4"></i>
                                    <span th:text="${post.likes}">0</span>
                                </div>
                                
                                <!-- 조회수 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="eye" class="w-4 h-4"></i>
                                    <span th:text="${post.views}">0</span>
                                </div>
                                
                                <!-- 작성자 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="user" class="w-4 h-4"></i>
                                    <span th:text="${post.anonymous ? '익명' : post.authorNickname}">글쓴이</span>
                                </div>
                                
                                <!-- 작성시간 -->
                                <div class="flex items-center space-x-1">
                                    <i data-lucide="clock" class="w-4 h-4"></i>
                                    <span class="timeago" th:data-date="${post.createdAt}">1시간 전</span>
                                </div>
                            </div>
                        </a>
                    </div>
                    
                    <!-- 페이지네이션 -->
                    <div class="mt-8 flex items-center justify-center space-x-4">
                        <!-- 이전 페이지 -->
                        <button th:if="${repliedPagination.currentPage > 1}"
                                th:onclick="|updateRepliedPostList(${repliedPagination.currentPage - 1})|"
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition">
                            <i data-lucide="chevron-left" class="w-4 h-4"></i>
                            <span>이전</span>
                        </button>
                        <button th:unless="${repliedPagination.currentPage > 1}"
                                disabled
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed">
                            <i data-lucide="chevron-left" class="w-4 h-4"></i>
                            <span>이전</span>
                        </button>
                        
                        <!-- 페이지 입력 -->
                        <div class="flex items-center space-x-2">
                            <input type="number"
                                   th:value="${repliedPagination.currentPage}"
                                   th:min="1"
                                   th:max="${repliedPagination.totalPage}"
                                   onchange="updateRepliedPostList(this.value)"
                                   class="w-16 px-3 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-gray-800">
                            <span class="text-gray-500" th:text="'/ ' + ${repliedPagination.totalPage}">/ 10</span>
                        </div>
                        
                        <!-- 다음 페이지 -->
                        <button th:if="${repliedPagination.currentPage < repliedPagination.totalPage}"
                                th:onclick="|updateRepliedPostList(${repliedPagination.currentPage + 1})|"
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition">
                            <span>다음</span>
                            <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                        <button th:unless="${repliedPagination.currentPage < repliedPagination.totalPage}"
                                disabled
                                class="flex items-center space-x-2 px-4 py-2 bg-gray-300 text-gray-500 rounded-lg cursor-not-allowed">
                            <span>다음</span>
                            <i data-lucide="chevron-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 푸터 -->
        <div th:replace="~{/layout/footer :: default-footer}"></div>
        <script src="/js/timeago.js"></script>
        
        <script th:inline="javascript">
            // Lucide 아이콘 초기화
            document.addEventListener('DOMContentLoaded', function ()
            {
                lucide.createIcons();
            });

            // 탭 전환 함수
            function switchTab(tabName)
            {
                const tabs = document.querySelectorAll('[role="tab"]');
                const tabPanes = document.querySelectorAll('[role="tabpanel"]');

                // 모든 탭 비활성화
                tabs.forEach(tab =>
                {
                    tab.classList.remove('border-gray-800', 'bg-gray-50', 'text-gray-800');
                    tab.classList.add('border-transparent', 'text-gray-500');
                    tab.setAttribute('aria-selected', 'false');
                });

                // 모든 탭 패널 숨기기
                tabPanes.forEach(pane =>
                {
                    pane.classList.add('hidden');
                    pane.classList.remove('block');
                });

                // 선택된 탭 활성화
                if (tabName === 'bookmarks')
                {
                    document.getElementById('bookmarks-tab').classList.remove('border-transparent', 'text-gray-500');
                    document.getElementById('bookmarks-tab').classList.add('border-gray-800', 'bg-gray-50', 'text-gray-800');
                    document.getElementById('bookmarks-tab').setAttribute('aria-selected', 'true');
                    document.getElementById('bookmarkList').classList.remove('hidden');
                    document.getElementById('bookmarkList').classList.add('block');
                } else if (tabName === 'posts')
                {
                    document.getElementById('posts-tab').classList.remove('border-transparent', 'text-gray-500');
                    document.getElementById('posts-tab').classList.add('border-gray-800', 'bg-gray-50', 'text-gray-800');
                    document.getElementById('posts-tab').setAttribute('aria-selected', 'true');
                    document.getElementById('userPostList').classList.remove('hidden');
                    document.getElementById('userPostList').classList.add('block');
                } else if (tabName === 'comments')
                {
                    document.getElementById('comments-tab').classList.remove('border-transparent', 'text-gray-500');
                    document.getElementById('comments-tab').classList.add('border-gray-800', 'bg-gray-50', 'text-gray-800');
                    document.getElementById('comments-tab').setAttribute('aria-selected', 'true');
                    document.getElementById('repliedPostList').classList.remove('hidden');
                    document.getElementById('repliedPostList').classList.add('block');
                }

                // 아이콘 재초기화
                updateAllTimeAgos();
                lucide.createIcons();
            }

            async function updateBookmarkList(pageNumber)
            {
                try
                {
                    const response = await fetch(`/user/activity/bookmark?bookmarkPage=${pageNumber}`);
                    document.getElementById('bookmarkList').outerHTML = await response.text();

                    // 탭 상태 복원
                    switchTab('bookmarks');

                    // 아이콘 재초기화
                    updateAllTimeAgos();
                    lucide.createIcons();
                }
                catch (error)
                {
                    console.error('Error:', error);
                }
            }

            async function updateUserPostList(pageNumber)
            {
                try
                {
                    const response = await fetch(`/user/activity/myPost?myPostPage=${pageNumber}`);
                    document.getElementById('userPostList').outerHTML = await response.text();

                    // 탭 상태 복원
                    switchTab('posts');

                    // 아이콘 재초기화
                    lucide.createIcons();
                }
                catch (error)
                {
                    console.error('Error:', error);
                }
            }

            async function updateRepliedPostList(pageNumber)
            {
                try
                {
                    const response = await fetch(`/user/activity/replied?repliedPage=${pageNumber}`);
                    document.getElementById('repliedPostList').outerHTML = await response.text();

                    // 탭 상태 복원
                    switchTab('comments');

                    // 아이콘 재초기화
                    updateAllTimeAgos();
                    lucide.createIcons();
                }
                catch (error)
                {
                    console.error('Error:', error);
                }
            }
        </script>
    </body>
</html>
